jQuery(document).ready(function(e){"use strict";let t=Date.now();if("undefined"==typeof wacvParams)return;const a={get(e){let t=e+"=",a=decodeURIComponent(document.cookie).split(";");for(let e=0;e<a.length;e++){let n=a[e];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""},set(e,t,a=86400){var n=new Date;n.setTime(n.getTime()+1e3*a);var c="expires="+n.toUTCString();document.cookie=e+"="+t+";"+c+";path=/"}},n={checkedStt:!1,cbRender:!1,fbCbRequire:!!parseInt(wacvParams.fbCbRequire),init(){e("#wacv-modal").length||this.setFbCheckBox(),this.confirmOptin(),this.requireCheckbox()},setFbCheckBox(){let n=this;if(a.get("wacv_fb_checkbox"))return;if(!(parseInt(wacvParams.appID)>0&&parseInt(wacvParams.pageID)>0))return;let c=`<div class='fb-messenger-checkbox' origin='${wacvParams.homeURL}' page_id='${wacvParams.pageID}' messenger_app_id='${wacvParams.appID}' user_ref='${t}'\n                        allow_login='true' size='large' ref='wacv_ref_message' skin='${wacvParams.appSkin}'></div>`;e(".fb-messenger-checkbox-container").append(c),function(e,t,a){let n,c=e.getElementsByTagName(t)[0],r=wacvParams.appLang||"en_US";e.getElementById(a)||((n=e.createElement(t)).id=a,n.src="https://connect.facebook.net/"+r+"/sdk.js",c.parentNode.insertBefore(n,c))}(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){FB.init({appId:wacvParams.appID,autoLogAppEvents:!0,xfbml:!0,version:"v3.3"}),FB.Event.subscribe("messenger_checkbox",function(e){switch(e.event){case"rendered":n.cbRender=!0;break;case"checkbox":"checked"===e.state&&(n.checkedStt=!0,a.set("wacv_fb_checkbox",!0))}}),FB.getLoginStatus(function(e){"connected"===e.status||"not_authorized"===e.status||"unknown"===e.status&&(n.fbCbRequire=!1)})}},getUserRef(){e.ajax({url:wacvParams.ajaxUrl,type:"post",data:{action:"wacv_get_info",user_ref:t},success(e){}})},confirmOptin(){let a=this;e("form.cart button[type=submit], .single_add_to_cart_button, .ajax_add_to_cart, .wacv-add-to-cart-btn, .wacv-close-popup").on("click",function(e){a.checkedStt&&(FB.AppEvents.logEvent("MessengerCheckboxUserConfirmation",null,{app_id:wacvParams.appID,page_id:wacvParams.pageID,ref:"wacv_ref_message",user_ref:t}),a.getUserRef())})},requireCheckbox(){let t=this;e("form.cart button[type=submit], .single_add_to_cart_button, .ajax_add_to_cart, .wacv-add-to-cart-btn").on("click",function(a){t.fbCbRequire&&!t.checkedStt&&t.cbRender&&(a.stopImmediatePropagation(),a.preventDefault(),e(".fb-messenger-checkbox").css({border:"1px solid red","border-radius":"5px"}))})}};n.init();const c={atcButton:"",redirectAfterATC:"",popup:"",init(){this.popup=e("#wacv-modal"),this.showPopup(),this.chooseAction(),this.afterAjaxATC()},showPopup:function(){if(!this.popup.length)return;let t=this;e("form.cart button[type=submit], .single_add_to_cart_button, .ajax_add_to_cart, .add_to_cart_button").on("mousedown",function(c){e('[tabindex="-1"]').removeAttr("tabindex"),a.get("wacv_get_email")||(c.stopImmediatePropagation(),c.preventDefault(),t.atcButton=e(this),!t.atcButton.hasClass("ajax_add_to_cart")&&wacvParams.redirect?t.atcButton.after(`<input type="hidden" name="wacv_redirect" value="${wacvParams.redirect}">`):t.redirectAfterATC=!0,t.popup.fadeIn(300),n.setFbCheckBox())})},chooseAction(){let t=this;e(".wacv-add-to-cart-btn").on("click",function(){e(".wacv-email-invalid-notice, .wacv-phone-number-invalid-notice").hide();let a=e(".wacv-popup-input-email").val(),n=e(".wacv-popup-input-phone-number").val(),c=e(".wacv-gdpr-checkbox"),r=!1;if(parseInt(wacvParams.gdprField)){c.removeClass("wacv-error"),0===e(".wacv-gdpr-checkbox:checked").length&&(c.addClass("wacv-error"),r=!0)}!t.emailValidation(a)&&parseInt(wacvParams.emailField)&&(e(".wacv-email-invalid-notice").show(),r=!0),!t.phoneValidation(n)&&parseInt(wacvParams.phoneField)&&"template-1"===wacvParams.style&&(e(".wacv-phone-number-invalid-notice").show(),r=!0),r||t.importInfo()}),e(".wacv-close-popup").on("click",function(){a.set("wacv_get_email",!0,wacvParams.dismissDelay),t.popup.fadeOut(300),t.atcButton.trigger("click")})},emailValidation:e=>(e=e?e.trim():e,/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)),phoneValidation:e=>(e=e?e.trim():e,/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(e)),importInfo(){let n=this;this.popup.fadeOut(200);let c={action:"wacv_get_info",billing_email:e(".wacv-popup-input-email").val(),billing_phone:e(".wacv-popup-input-phone-number").val(),user_ref:t};e.ajax({url:wacvParams.ajaxUrl,data:c,type:"post",xhrFields:{withCredentials:!0},beforeSend:function(){e(".wacv-add-to-cart-btn").addClass("loading")},success:function(e){a.set("wacv_get_email",!0),n.atcButton.trigger("click")},error:function(e){}})},afterAjaxATC(){e(document).ajaxComplete(function(e,t,a){"/?wc-ajax=add_to_cart"===a.url&&!0===c.redirectAfterATC&&wacvParams.redirect?window.location.replace(wacvParams.redirect):c.showPopup()})}};c.init()});